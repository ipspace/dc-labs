<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Ivan Pepelnjak, ipSpace.net AG">
        <link rel="canonical" href="https://ipspace.github.io/dc-labs/6-robust-layer-2-fabric/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Design a Robust Layer-2 Fabric - Data Center</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Data Center</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Challenges <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../1-services-requirements/" class="dropdown-item">Define the Services and Requirements</a>
</li>
                                    
<li>
    <a href="../4-storage/" class="dropdown-item">Design a Storage Solution</a>
</li>
                                    
<li>
    <a href="../5-small-fabric/" class="dropdown-item">Build a Small Data Center Fabric</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Design a Robust Layer-2 Fabric</a>
</li>
                                    
<li>
    <a href="../7-overlay/" class="dropdown-item">Design an Overlay Virtual Network Fabric</a>
</li>
                                    
<li>
    <a href="../11-extend-fabric/" class="dropdown-item">Extend a Leaf-and-Spine Fabric</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../5-small-fabric/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../7-overlay/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>

                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3">
<div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
  <div class="navbar-header">
      <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
          <span class="fa fa-angle-down"></span>
      </button>
  </div>

  
  
  
  
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary"  style="margin-bottom: 1em;">
      <ul class="nav flex-column">
          
      <li class="nav-item" data-level="1"><a href="#design-a-robust-layer-2-fabric" class="nav-link">Design a Robust Layer-2 Fabric</a>
        <ul class="nav flex-column">
      <li class="nav-item" data-level="2"><a href="#existing-fabric-design" class="nav-link">Existing Fabric Design</a>
        <ul class="nav flex-column">
        </ul>
      </li>
      <li class="nav-item" data-level="2"><a href="#external-connectivity" class="nav-link">External Connectivity</a>
        <ul class="nav flex-column">
        </ul>
      </li>
      <li class="nav-item" data-level="2"><a href="#new-fabric-requirements" class="nav-link">New Fabric Requirements</a>
        <ul class="nav flex-column">
        </ul>
      </li>
        </ul>
      </li>
      </ul>
    </div>
  
  
  <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
    <ul class="nav flex-column">
        
    
        
    
    <li class="nav-item" data-level="">
      
        <a class="nav-link">Challenges</a>
      
      
        <ul class="nav flex-column">
    
    <li class="nav-item" data-level="">
      
        <a href="../1-services-requirements/" class="nav-link">Define the Services and Requirements</a>
      
      
    </li>
    
    
    <li class="nav-item" data-level="">
      
        <a href="../4-storage/" class="nav-link">Design a Storage Solution</a>
      
      
    </li>
    
    
    <li class="nav-item" data-level="">
      
        <a href="../5-small-fabric/" class="nav-link">Build a Small Data Center Fabric</a>
      
      
    </li>
    
    
    <li class="nav-item" data-level="">
      
        <a href="./" class="nav-link">Design a Robust Layer-2 Fabric</a>
      
      
    </li>
    
    
    <li class="nav-item" data-level="">
      
        <a href="../7-overlay/" class="nav-link">Design an Overlay Virtual Network Fabric</a>
      
      
    </li>
    
    
    <li class="nav-item" data-level="">
      
        <a href="../11-extend-fabric/" class="nav-link">Extend a Leaf-and-Spine Fabric</a>
      
      
    </li>
    
        </ul>
      
    </li>
    
    </ul>
  </div>

</div></div>
                    <div class="col-md-9" role="main">

<h1 id="design-a-robust-layer-2-fabric">Design a Robust Layer-2 Fabric</h1>
<p>ACME Inc. is replacing an existing data center fabric with a next-generation solution. They have two data centers less than 100 km apart and decided to implement a layer-2 interconnect and long-distance vMotion to simplify hardware maintenance.</p>
<p>Most compute workloads are virtualized, but they still have a cluster of bare-metal servers running legacy database servers.</p>
<h2 id="existing-fabric-design">Existing Fabric Design</h2>
<p>ACME architects are aware of the limitations of stretched VLANs (including increased latency and traffic flows crossing the data center interconnect) and have tried to limit their impact by deploying each application stack mainly within a single data center:</p>
<ul>
<li>Each data center is assigned a /16 prefix from 10.0.0.0/8 address space;</li>
<li>Legacy application stacks (or groups of applications) are assigned to one of the data centers and get a single VLAN and a single /24 IP subnet belonging to that data center;</li>
<li>Applications with scale-out architecture are assigned two VLANs and two /24 IP subnets (one from the address space of each data center);</li>
</ul>
<p>A typical addressing plan is shown in the following diagram:</p>
<p><img alt="Typical addressing plan" src="../l2dci-addressing.png" /></p>
<p>All VLANs are stretched across both data centers, allowing unlimited (but controlled) VM mobility. However, ACME took these precautions to minimize cross-DC traffic:</p>
<ul>
<li>Hosts belonging to a single IP subnet SHOULD reside within a single data center but COULD be moved to the other data center if needed;</li>
<li>Applications SHOULD use common services (example: Windows AD, backup…) within the same data center but COULD use services from the other data center (example: shared database).</li>
</ul>
<p>You’ll find an overview of L2/L3 connectivity in the following diagram:</p>
<p><img alt="VLAN topology" src="../l2dci-topology.png" /></p>
<h2 id="external-connectivity">External Connectivity</h2>
<p>Application segments are connected to a shared transit segment through stateful firewalls. Each application segment is an independent virtual context within the firewall.</p>
<p>The firewalls are physical appliances deployed in an active/backup stretched cluster. Each virtual context is active only on one of the appliances, while different contexts could be active on different appliances to get per-context load balancing. The primary virtual context for each application is within the same data center as its application (the following diagram displays a few contexts).</p>
<p><img alt="External connectivity and firewalls" src="../l2dci-firewalling.png" /></p>
<h2 id="new-fabric-requirements">New Fabric Requirements</h2>
<p>ACME wants to replace the existing L2-only fabric that uses the Spanning Tree Protocol (STP) and MLAG with a modern data center fabric without changing applications or firewall configurations.</p>
<p>Given these limitations, design the most stable data center fabric you can.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
<hr>
    <p>(C) 2023 Ivan Pepelnjak (ipSpace.net AG)</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
